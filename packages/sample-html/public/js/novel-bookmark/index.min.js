var u="element-p-",T="data-novel-bookmark-id",_="data-novel-bookmark-intersecting";function y({paragraphTag:o="p",...e}){let t=N({...e,paragraphTag:o});return t?()=>t.disconnect():null}function N({wrapperClass:o,paragraphTag:e}){let t=document.getElementsByClassName(o);if(t.length===0)return null;let m=t[0].getElementsByTagName(e);for(let r=0;r<m.length;r++){let i=`${u}${r}`;m[r].dataset.novelBookmarkId=i}let n=new IntersectionObserver(r=>{for(let i of r){let p=i.target;p.dataset.novelBookmarkId&&(p.dataset.novelBookmarkIntersecting=i.isIntersecting.toString())}});for(let r of m)n.observe(r);return n}var I="novel-bookmarks",S="novel-bookmark-p-id";function O({type:o,key:e,value:t}){return o==="local"?localStorage.setItem(e,t):sessionStorage.setItem(e,t)}function A({type:o,key:e}){return o==="local"?localStorage.getItem(e):sessionStorage.getItem(e)}function x({type:o,key:e}){return o==="local"?localStorage.removeItem(e):sessionStorage.removeItem(e)}function f(o){O({type:"local",key:I,value:JSON.stringify(o)})}function h(o){O({type:"session",key:S,value:o})}function P(){return A({type:"local",key:I})}function b(){let o=A({type:"session",key:S});return x({type:"session",key:S}),o}function L(){x({type:"local",key:I})}function v(){let o=b();if(!o)return;let e=document.querySelector(`[${T}="${o}"]`);e&&e.scrollIntoView({behavior:"smooth"})}function s(){let o=P()??"[]",e=JSON.parse(o);return Array.isArray(e)?e.filter(t=>M(t)):[]}function M(o){return typeof o!="object"||o===null?!1:"title"in o&&typeof o.title=="string"&&"url"in o&&typeof o.url=="string"}function k(){return s().some(e=>e.url===window.location.href)}function C(o){let e=s();if(e.length>=100)return;let t=Array.from(document.querySelectorAll(`[${_}="true"]`)).map(a=>Number.parseInt(a.dataset.novelBookmarkId?.replace("element-p-","")??"0"));e.push({title:document.title,url:window.location.href,id:t.length>0?`${u}${Math.min(...t)}`:void 0}),f(e)}function g(o){let t=s().filter(a=>a.url!==(o?o.url:window.location.href));if(t.length>0){f(t);return}L()}function R(o){o.id&&h(o.id)}function go(){let o=null;document.readyState!=="loading"?o=y({wrapperClass:"Novel"}):document.addEventListener("readystatechange",()=>{document.readyState==="interactive"&&(o=y({wrapperClass:"Novel"}))}),document.readyState==="complete"?v():document.addEventListener("readystatechange",()=>{document.readyState==="complete"&&v()}),window.addEventListener("beforeunload",()=>{o&&(o(),o=null)},!1)}var B="NovelBookmarkButton",E="NovelBookmarkList";function vo({parentElement:o=document.body,className:e="NovelBookmarkButton",bookmarkedText:t="Remove Bookmark",notBookmarkedText:a="Add Bookmark",onClick:m}){let n=document.createElement("button");n.type="button",n.id=B,n.classList.add(e);let r=k();n.textContent=r?t:a,n.dataset.bookmarked=r?"true":"false",n.addEventListener("click",()=>{k()?(g(),n.textContent=a,n.dataset.bookmarked="false"):(C(),n.textContent=t,n.dataset.bookmarked="true"),m?.()}),o.appendChild(n)}function D({bookmark:o,notBookmarkedText:e="Add Bookmark",...t}){g(o);let a=document.getElementById(B);a&&!k()&&(a.textContent=e,a.dataset.bookmarked="false"),w({notBookmarkedText:e,...t})}function w({parentElement:o=document.body,className:e="NovelBookmarkList",noBookmarkText:t="No bookmarks",removeBookmarkButtonText:a="Remove",...m}){document.getElementById(E)?.remove();let n=s(),r=document.createElement("div");if(r.id=E,r.classList.add(e),n.length===0){r.textContent=t,r.dataset.empty="true",o.appendChild(r);return}r.dataset.empty="false";let i=document.createElement("ul");for(let p of n){let l=document.createElement("li"),c=document.createElement("a");c.href=p.url,c.textContent=p.title,c.addEventListener("click",()=>{R(p)});let d=document.createElement("button");d.type="button",d.textContent=a,d.addEventListener("click",()=>D({...m,parentElement:o,className:e,noBookmarkText:t,removeBookmarkButtonText:a,bookmark:p})),l.appendChild(c),l.appendChild(d),i.appendChild(l)}r.appendChild(i),o.appendChild(r)}export{vo as createBookmarkButton,w as createBookmarkList,go as initialize};
